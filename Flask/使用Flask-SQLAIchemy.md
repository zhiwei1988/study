Flask-SQLAlchemy 是一个 Flask 扩展， 简化了在 Flask 程序中使用 SQLAlchemy 的操作。 SQLAlchemy 是一个很强大的关系型数据库框架， 支持多种数据库后台。 SQLAlchemy 提 供了高层 ORM， 也提供了使用数据库原生 SQL 的低层功能。

## 安装

`pip install flask-sqlalchemy`

## 数据库操作

### 查询行

Flask-SQLAlchemy 为每个模型类都提供了 query 对象。

**取回对应表中的所有记录**

`Table.query.all()`

> Table 可以是任意模型类名

使用过滤器可以配置 query 对象进行更精确的数据库查询。

**常用的SQLAlchemy查询过滤器**

| 过滤器      | 说明                                                 |
| ----------- | ---------------------------------------------------- |
| filter()    | 把过滤器添加到原查询上，返回一个新查询               |
| filter_by() | 把等值过滤器添加到原查询上，返回一个新查询           |
| limit()     | 使用指定的值限制原查询返回的结果数量，返回一个新查询 |
| offset()    | 偏移原查询返回的结果，返回一个新查询                 |
| order_by()  | 根据指定条件对原查询结果进行排序，返回一个新查询     |
| group_by()  | 根据指定条件对原查询结果进行分组，返回一个新查询     |

在查询上应用指定的过滤器后，需执行查询函数

**最常使用的SQLAlchemy查询执行函数**

| 方法           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| all()          | 以列表形式返回查询的所有结果                                 |
| first()        | 返回查询的第一个结果，如果没有结果，则返回 None              |
| first_or_404() | 返回查询的第一个结果，如果没有结果，则终止请求，返回 404 错误响应 |
| get()          | 返回指定主键对应的行，如果没有对应的行，则返回 None          |
| get_or_404()   | 返回指定主键对应的行，如果没找到指定的主键，则终止请求，返回 404 错误响应 |
| count()        | 返回查询结果的数量                                           |
| paginate()     | 返回一个 Paginate 对象，它包含指定范围内的结果               |

查找角色为 "User" 的所有用户

`User.query.filter_by(role=user_role).all()`

